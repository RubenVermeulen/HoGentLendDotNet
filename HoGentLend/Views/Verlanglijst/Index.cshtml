
@model IEnumerable<HoGentLend.ViewModels.MateriaalViewModel>
@using System.Linq

@{
    ViewBag.Title = "Index";
}

<h2>Verlanglijstje</h2>

<p>
    Dit is uw verlanglijstje. Je kan materialen toevoegen aan dit verlanglijstje vanuit de catalogus. Na het toevoegen van uw favoriete materialen kan je kiezen hoeveel stuks van elk materiaal je wilt reseveren.
    Je kiest een begin datum en dan kan je uw reservatie plaatsen.
</p>
<hr />

<div id="wishlist">


    @if (!Model.Any())
    {
        <p>Er zit nog niets in je verlanglijstje.</p>
    }
    else
    {
        using (Html.BeginForm("Add", "Reservatie", FormMethod.Post))
        {
            int counter = -1;
            foreach (var item in Model)
            {
                counter = counter + 1;
                <div class="row wishlist-item">
                    <div class="col-md-12">
                        <div class="col-md-2">

                            <!-- IMAGE -->
                            @if (item.PhotoBase64 != null)
                            {
                                <div class="wishlist-img" style="background-image: url(data:image/png;base64,@item.PhotoBase64)">
                                    <a href="data:image/png;base64,@item.PhotoBase64" data-lightbox="@item.Name"></a>
                                </div>
                            }
                            else
                            {
                                <div class="wishlist-img"></div>
                            }

                        </div>
                        <div class="col-md-6">
                            @Html.ActionLink(item.Name, "Detail", "Catalogus", new { id = item.Id }, null)
                        </div>
                        <div class="col-md-2">
                            <div class="form-group">
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="col-md-4 col-md-offset-2">
                                            <label for="amount">Aantal</label>
                                        </div>
                                        <div class="col-md-6">
                                            <input type="hidden" name="reservatiepartmodels[@counter].MateriaalId" value="@item.Id" />
                                            <input type="number" id="amount" class="form-control" name="reservatiepartmodels[@counter].Amount" value="0" />
                                        </div>
                                    </div>
                                </div>


                            </div>
                        </div>
                        <div class="col-md-2">
                            @*<button type="submit" class="btn btn-default" name="bevestig" id="@(item.Id)">
                                    Verwijder uit verlanglijstje
                                </button>*@
                            @Html.ActionLink("Verwijder uit verlanglijstje", "Remove", "Verlanglijst", new { materiaalId = item.Id }, new { @class = "btn btn-default" })
                        </div>
                    </div>
                </div>

                    <hr />
            }

            <div class="row">
                <div class="col-md-12">
                    <div class="col-md-6 col-sm-6">
                        <div class="form-group">
                            <label for="date">Ophaaldatum (om @ViewBag.ophaalTijd)</label>
                            <input type="text" id="date" name="ophaalDatum" class="form-control" required />
                            <script>
                                Date.prototype.addDays = function(days)
                                {
                                    var dat = new Date(this.valueOf());
                                    dat.setDate(dat.getDate() + days);
                                    return dat;
                                }
                                window.addEventListener("load", function () {
                                    var ophaalDag = "@ViewBag.ophaalDag";
                                    ophaalDag = ophaalDag.toLowerCase();
                                    var dagToNr = {
                                        maandag: 1,
                                        dinsdag: 2,
                                        woensdag: 3,
                                        donderdag: 4,
                                        vrijdag: 5,
                                        zaterdag: 6,
                                        zondag: 0
                                    };
                                    var ophaaldagNr = dagToNr[ophaalDag];

                                    $('#date').datepicker({
                                        format: "dd/mm/yyyy",
                                        weekStart: 1,
                                        language: "nl-BE",
                                        daysOfWeekDisabled: "0,1,2,3,4,5,6".replace(","+ophaaldagNr, ""),
                                        daysOfWeekHighlighted: String(ophaaldagNr),
                                        todayHighlight: true
                                    });
                                    $("#date").change(function () {
                                        var dt = $("#date").datepicker("getDate");
                                        if (dt == null){
                                            $("#indienDatum").text("-");
                                            return;
                                        }
                                        var nrOfWeeks = @ViewBag.aantalWeken;
                                        dt = dt.addDays(nrOfWeeks * 7);
                                        dt.setDate(dt.getDate() + (dagToNr["@ViewBag.indienDag"] - dt.getDay()));
                                        var dd = dt.getDate();
                                        var mm = dt.getMonth()+1;

                                        var yyyy = dt.getFullYear();
                                        if(dd<10){
                                            dd='0'+dd
                                        } 
                                        if(mm<10){
                                            mm='0'+mm
                                        } 
                                        var indienDatumStr = dd+'/'+mm+'/'+yyyy;
                                        $("#indienDatum").text(indienDatumStr);
                                    });
                                });
                            </script>
                        </div>
                    </div>
                    <div class="col-md-6 col-sm-6">
                        <div class="form-group">
                            <label for="date">Indiendatum (om @ViewBag.indienTijd)</label>
                            <p id="indienDatum">-</p>
                        </div>
                    </div>
                </div>
            </div>

            <button type="submit" class="btn btn-primary" name="bevestig" value="-1">
                Reserveren
            </button>

        }
    }

</div>
