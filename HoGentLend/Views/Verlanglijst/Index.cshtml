
@model IEnumerable<HoGentLend.ViewModels.MateriaalViewModel>
@using System.Linq

@{
    ViewBag.Title = "Index";
}

<h2>Verlanglijstje</h2>


<hr />

<div id="wishlist">


    @if (!Model.Any())
    {
        <p>Er zit nog niets in je verlanglijstje.</p>
    }
    else
    {

        <div class="wishlist-header">
            <div class="row">
                <div class="hidden-xs hidden-sm col-md-2 col-xs-4">Afbeelding</div>
                <div class="hidden-xs hidden-sm col-lg-8 col-md-7 col-xs-4">Materiaal</div>
                <div class="hidden-xs hidden-sm col-lg-2 col-md-3 col-xs-4">Aantal</div>
                <div class="col-xs-12 hidden-md hidden-lg" >Verlanglijstje</div>
            </div>  
        </div>


        using (Html.BeginForm("Add", "Reservatie", FormMethod.Post))
        {
            int counter = -1;
            foreach (var item in Model)
            {
                counter = counter + 1;
                <div class="wishlist-item">
                    <div class="row ">
                            <div class="col-md-2">

                                <!-- IMAGE -->
                                @if (item.PhotoBase64 != null)
                                {
                                    <div class="wishlist-img" style="background-image: url(data:image/png;base64,@item.PhotoBase64)">
                                        <a href="data:image/png;base64,@item.PhotoBase64"></a>
                                    </div>
                                }
                                else
                                {
                                    <div class="wishlist-img"></div>
                                }

                            </div>
                            <div class="col-lg-8 col-md-7 name">
                                @Html.ActionLink(item.Name, "Detail", "Catalogus", new { id = item.Id }, null)
                            </div>

                            <div class="col-lg-1 col-md-2 amount">
                                <input type="hidden" name="reservatiepartmodels[@counter].MateriaalId" value="@item.Id" />
                                <input type="number" id="amount" class="form-control" min="0" name="reservatiepartmodels[@counter].Amount" value="0" />

                            </div>
                            <div class="col-md-1 delete">
                                <a href='@Url.Action("Remove", "Verlanglijst", new { materiaalId = item.Id})' class="btn btn-default confirmation-delete" data-name="@item.Name" title="Verwijderen">
                                    <span class='glyphicon glyphicon-trash'></span>
                                </a>  
                            </div>
                        </div>
                    
                </div>
            }

            <div class="wishlist-footer">
                <div class="row hidden-xs">
                    <div class="col-sm-4">
                        <div class="form-group">
                            <label for="date">Ophaaldatum (om @ViewBag.ophaalTijd)</label>
                        </div>
                    </div>
                    <div class="col-sm-8">
                        <div class="form-group">
                            <label>Indiendatum (om @ViewBag.indienTijd)</label>
                        </div>
                    </div>
                </div> 

                <div class="row">
                    <div class="col-sm-4">
                        <div class="form-group">
                            <label for="date" class="hidden-sm hidden-md hidden-lg">Ophaaldatum (om @ViewBag.ophaalTijd)</label>
                            <div class="input-group">
                                <div class="input-group-addon">
                                    <span class="glyphicon glyphicon-calendar"></span>
                                </div>
                                <input type="text" id="date" name="ophaalDatum" class="form-control" required />
                            </div>
                        </div>
                    </div>
                    <div class="col-sm-5 col-md-6">
                        <div class="form-group">
                            <label class="hidden-sm hidden-md hidden-lg">Indiendatum (om @ViewBag.indienTijd)</label>
                            <p id="indienDatum">-</p>
                        </div>
                    </div>
                    <div class="col-sm-3 col-md-2">
                        <div class="form-group">
                            <button type="submit" class="btn btn-primary form-control" name="bevestig" value="-1">
                                Reserveren
                            </button>
                        </div>
                        
                    </div>
                </div> 
            </div>           
        }
    }

</div>

<!-- Modal box -->
<div id="confirmation-delete" class="modal fade">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title">Bevestiging</h4>
            </div>
            <div class="modal-body">
                <p>
                    Je staat op het punt "<strong><span class="name"></span></strong>" uit je verlanglijstje te verwijderen. Ben je zeker?
                </p>
            </div>
            <div class="modal-footer">
                <button id="confirm" type="button" class="btn btn-primary">Ja</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">Nee</button>
            </div>
        </div>
    </div>
</div>
<!-- --- -->

@section scripts
{
    <script>
        // Confirmation Delete
        $('.confirmation-delete').click(function(e) {
            var a = $(this);

            var confirmationDelete = $('#confirmation-delete');
            confirmationDelete.find('.name').html(a.attr('data-name'));
            confirmationDelete.modal('show');

            $('#confirm').click(function() {
                window.location.replace(a.attr('href'));
            });

            e.preventDefault();
        });


        // Ajax Post Call Wishlist
        $('button.reserveer').click(function (e) {
            var button = $(this);
            var id = button.attr('id');

            $.post("/Verlanglijst/Add", {id: id}, function(data) {
                if (data.status === 'success') {
                    button.attr('disabled', 'disabled');
                    button.addClass('reserveer-active');
                    button.html('<span class="glyphicon glyphicon-heart"></span> In verlanglijstje');

                    var success = $("#success");
                    success.html(data.message);
                    success.slideDown();

                    setTimeout(function() {
                        success.slideUp();
                    }, 3500);
                }
            });
        });

        // Date picker
        Date.prototype.addDays = function(days) {
            var dat = new Date(this.valueOf());
            dat.setDate(dat.getDate() + days);
            return dat;
        }
        window.addEventListener("load", function() {
            var ophaalDag = "@ViewBag.ophaalDag";
            ophaalDag = ophaalDag.toLowerCase();
            var dagToNr = {
                maandag: 1,
                dinsdag: 2,
                woensdag: 3,
                donderdag: 4,
                vrijdag: 5,
                zaterdag: 6,
                zondag: 0
            };
            var ophaaldagNr = dagToNr[ophaalDag];

            $('#date').datepicker({
                format: "dd/mm/yyyy",
                weekStart: 1,
                language: "nl-BE",
                daysOfWeekDisabled: "0,1,2,3,4,5,6".replace("," + ophaaldagNr, ""),
                daysOfWeekHighlighted: String(ophaaldagNr),
                todayHighlight: true,
                startDate: "@ViewBag.vandaag"
            });
            $("#date").change(function() {
                var dt = $("#date").datepicker("getDate");
                if (dt == null) {
                    $("#indienDatum").text("-");
                    return;
                }
                var nrOfWeeks = @ViewBag.aantalWeken;
                dt = dt.addDays(nrOfWeeks * 7);
                dt.setDate(dt.getDate() + (dagToNr["@ViewBag.indienDag"] - dt.getDay()));
                var dd = dt.getDate();
                var mm = dt.getMonth() + 1;

                var yyyy = dt.getFullYear();
                if (dd < 10) {
                    dd = '0' + dd
                }
                if (mm < 10) {
                    mm = '0' + mm
                }
                var indienDatumStr = dd + '/' + mm + '/' + yyyy;
                $("#indienDatum").text(indienDatumStr);
            });
        });
    </script>
}
